`Number of households` = `Which Are Occupied`
)
# Homelessness applications by local authority
scotland_homelessness <- read_excel(tf, sheet = "T1", range = "A6:F39")
scotland_homelessness <-
scotland_homelessness |>
select(ltla21_name = `Local Authority`, applications = `2022-23`) |>
filter(ltla21_name != "Scotland") |>
left_join(scottish_ltla_names_codes) |>
# Calculate rate
left_join(scotland_households) |>
mutate(`Assessed as homeless or threatened with homelessness per 1,000` = applications / `Number of households` * 1000) |>
select(ltla21_code, `Assessed as homeless or threatened with homelessness per 1,000`)
# Scotland ----
# Download latest homelessness data
# Source: https://www.gov.scot/publications/homelessness-in-scotland-2022-23/documents/
tf <- download_file("https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2023/08/homelessness-in-scotland-2022-23/documents/main-tables_homelessness-in-scotland-2022-23/main-tables_homelessness-in-scotland-2022-23/govscot%3Adocument/Main%2Btables_Homelessness%2Bin%2BScotland%2B2022-23.xlsx", ".xlsx")
## Local Authority names and codes ----
scottish_ltla_names_codes <-
geographr::boundaries_ltla21 |>
sf::st_drop_geometry() |>
filter(str_detect(ltla21_code, "^S")) |>
# Match to LA names in the homelessness data
mutate(ltla21_name = str_replace(ltla21_name, " and ", " & ")) |>
mutate(
ltla21_name = case_match(
ltla21_name,
"Na h-Eileanan Siar" ~ "Eilean Siar",
"City of Edinburgh" ~ "Edinburgh",
"Shetland Islands" ~ "Shetland",
.default = ltla21_name
)
)
## Household estimates ----
# Source: https://statistics.gov.scot/resource?uri=http%3A%2F%2Fstatistics.gov.scot%2Fdata%2Fhousehold-estimates
scotland_households <- read_csv("https://statistics.gov.scot/slice/observations.csv?&dataset=http%3A%2F%2Fstatistics.gov.scot%2Fdata%2Fhousehold-estimates&http%3A%2F%2Fpurl.org%2Flinked-data%2Fcube%23measureType=http%3A%2F%2Fstatistics.gov.scot%2Fdef%2Fmeasure-properties%2Fcount&http%3A%2F%2Fpurl.org%2Flinked-data%2Fsdmx%2F2009%2Fdimension%23refPeriod=http%3A%2F%2Freference.data.gov.uk%2Fid%2Fyear%2F2021", skip = 7)
scotland_households <-
scotland_households |>
mutate(ltla21_code = str_extract(`http://purl.org/linked-data/sdmx/2009/dimension#refArea`, "S[0-9]+")) |>
filter(str_detect(ltla21_code, "^S12")) |>
select(
ltla21_code,
`Number of households` = `Which Are Occupied`
)
# Homelessness applications by local authority
scotland_homelessness <- read_excel(tf, sheet = "T1", range = "A6:F39")
scotland_homelessness <-
scotland_homelessness |>
select(ltla21_name = `Local Authority`, applications = `2022-23`) |>
filter(ltla21_name != "Scotland") |>
left_join(scottish_ltla_names_codes) |>
# Calculate rate
left_join(scotland_households) |>
mutate(`Assessed as homeless or threatened with homelessness per 1,000` = applications / `Number of households` * 1000) |>
select(ltla21_code, `Assessed as homeless or threatened with homelessness per 1,000`)
## Temporary accommodation ----
# Source: https://statistics.gov.scot/resource?uri=http%3A%2F%2Fstatistics.gov.scot%2Fdata%2Ftemporary-accommodation-statistics
scotland_temp_accom <- read_csv("https://statistics.gov.scot/downloads/cube-table?uri=http%3A%2F%2Fstatistics.gov.scot%2Fdata%2Ftemporary-accommodation-statistics")
scotland_temp_accom <-
scotland_temp_accom |>
filter(DateCode == max(DateCode) & FeatureType == "Council Area") |>
select(
ltla21_code = FeatureCode,
`Households in temporary accommodation` = Value
) |>
# Calculate rate per 1000 households
left_join(scotland_households) |>
mutate(`Households in temporary accommodation per 1,000` = `Households in temporary accommodation` / `Number of households` * 1000) |>
select(ltla21_code, `Households in temporary accommodation per 1,000`)
library(tidyverse)
library(demographr)
library(geographr)
library(compositr)
library(readODS)
library(readxl)
library(httr)
# England ----
## Homelessness ----
# Load live tables on homelessness
# Source: https://www.gov.uk/government/statistical-data-sets/live-tables-on-homelessness
GET(
"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1173277/Detailed_LA_202303.ods",
write_disk(tf <- tempfile(fileext = ".ods"))
)
england_homeless_raw <- read_ods(tf, sheet = "A1", skip = 6)
england_homeless <- england_homeless_raw[, c(1, 2, 15, 16)]
names(england_homeless) <- c("ltla21_code", "ltla21_name", "Households assessed as threatened with homelessness per (000s)", "Households assessed as homeless per (000s)")
# Keep only Local Authority Districts
england_homeless <-
england_homeless |>
as_tibble() |>
filter(str_detect(ltla21_code, "^E0[6-9]")) |>
mutate(
`Households assessed as threatened with homelessness per (000s)` = as.numeric(`Households assessed as threatened with homelessness per (000s)`),
`Households assessed as homeless per (000s)` = as.numeric(`Households assessed as homeless per (000s)`)
)
## Temporary accommodation ----
england_temp_accomm_raw <- read_ods(tf, sheet = "TA1", skip = 6)
england_temp_accomm <- england_temp_accomm_raw[, c(1, 2, 7)]
names(england_temp_accomm) <- c("ltla21_code", "ltla21_name", "Total number of households in TA per (000s)")
# Keep only Local Authority Districts
england_temp_accomm <-
england_temp_accomm |>
as_tibble() |>
filter(str_detect(ltla21_code, "^E0[6-9]")) |>
mutate(`Households in temporary accommodation per 1,000` = as.numeric(`Total number of households in TA per (000s)`)) |>
select(ltla21_code, `Households in temporary accommodation per 1,000`)
## Housing stock and waiting list data ----
# Load LA housing statistics
# Source: https://www.gov.uk/government/collections/local-authority-housing-data // https://www.gov.uk/government/statistical-data-sets/local-authority-housing-statistics-data-returns-for-2021-to-2022
GET(
"https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/1166232/LAHS_21_22_accessible.ods",
write_disk(tf <- tempfile(fileext = ".ods"))
)
england_stock_waits <- read_ods(tf, sheet = "Local_Authority_Data", skip = 2)
# Keep relevant columns
# Definitions of column codes are from: https://www.gov.uk/government/publications/completing-local-authority-housing-statistics-2020-to-2021-guidance-notes-and-bulk-upload
england_stock_waits <-
england_stock_waits |>
select(
ltla21_code = LA_Code,
# ltla21_name = organisation.name,
# Total number of households on the waiting list at 31 March
`Households on housing waiting list` = cc1a,
# Total number of vacant dwellings owned by any local authority
# (either your own or another local authority) within your district area at 31 March of the reporting year
`Vacant dwellings` = e1a,
# total_stock = a2ia,
# Total social rent stock
social_rent_stock = a2iaa,
# Total affordable rent stock
affordable_rent_stock = a2iab
) |>
mutate(social_rent_stock = as.integer(social_rent_stock), affordable_rent_stock = as.integer(affordable_rent_stock)) |>
mutate(`Housing stock` = social_rent_stock + affordable_rent_stock) |>
select(-social_rent_stock, -affordable_rent_stock)
# Calculate rates
england_stock_waits <-
england_stock_waits |>
left_join(demographr::households21_ltla21 |> select(-ltla21_name)) |>
mutate(
`Households on housing waiting list per 1,000` = `Households on housing waiting list` / households * 1000,
`Social housing stock as a proportion of all households` = `Housing stock` / households,
`Vacant dwellings per 1,000 units of social housing stock` = if_else(is.na(`Housing stock`) | `Housing stock` == 0, `Vacant dwellings`, `Vacant dwellings` / `Housing stock` * 1000)
) |>
select(
ltla21_code,
`Households on housing waiting list per 1,000`,
`Social housing stock as a proportion of all households`,
`Vacant dwellings per 1,000 units of social housing stock`
)
## Combine datasets and calculate deciles ----
england <-
england_homeless |>
left_join(england_temp_accomm) |>
left_join(england_stock_waits) |>
mutate(
stock_quintile = as.integer(Hmisc::cut2(`Social housing stock as a proportion of all households`, g = 5)),
waiting_quintile = as.integer(Hmisc::cut2(`Households on housing waiting list per 1,000`, g = 5)),
homeless_quintile = as.integer(Hmisc::cut2(`Households assessed as threatened with homelessness per (000s)`, g = 5)),
temp_accom_quintile = as.integer(Hmisc::cut2(`Households in temporary accommodation per 1,000`, g = 5)),
vacancies_quintile = as.integer(Hmisc::cut2(`Vacant dwellings per 1,000 units of social housing stock`, g = 5))
)
# Save
write_csv(england, "data/housing/housing-england.csv")
# Scotland ----
# Download latest homelessness data
# Source: https://www.gov.scot/publications/homelessness-in-scotland-2022-23/documents/
tf <- download_file("https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2023/08/homelessness-in-scotland-2022-23/documents/main-tables_homelessness-in-scotland-2022-23/main-tables_homelessness-in-scotland-2022-23/govscot%3Adocument/Main%2Btables_Homelessness%2Bin%2BScotland%2B2022-23.xlsx", ".xlsx")
load("C:/Users/JennaTan/Documents/geographr/data/boundaries_lsoa11.rda")
View(boundaries_lsoa11)
# ---- Load libraries ----
library(tibble)
# ---- Build data ----
# ONS geoportal query urls can be found on the "API Explorer" tab.
query_urls <-
tribble(
# Column Names
~geog_type, ~id, ~publish_date, ~license, ~query, ~source,
# Boundaries
"boundaries", "ccg21", "01.04.21", "OGLv3", "https://opendata.arcgis.com/datasets/d6acd30ad71f4e14b4de808e58d9bc4c_0.geojson", "https://geoportal.statistics.gov.uk/datasets/clinical-commissioning-groups-april-2021-en-buc/explore?location=51.835875%2C-2.452657%2C6.00",
"boundaries", "countries20", "01.12.20", "OGLv3", "https://opendata.arcgis.com/datasets/bb7104d3a9c04937be57e408288282dc_0.geojson", "https://geoportal.statistics.gov.uk/datasets/countries-december-2020-uk-buc/explore?location=54.650000C-3.250000%2C6.04",
"boundaries", "dz11", "01.01.11", "OGLv3", "https://maps.gov.scot/ATOM/shapefiles/SG_DataZoneBdry_2011.zip", "https://spatialdata.gov.scot/geonetwork/srv/eng/catalog.search#/metadata/7d3e8709-98fa-4d71-867c-d5c8293823f2",
"boundaries", "hb19", "01.01.19", "OGLv3", "https://maps.gov.scot/ATOM/shapefiles/SG_NHS_HealthBoards_2019.zip", "https://spatialdata.gov.scot/geonetwork/srv/eng/catalog.search;jsessionid=2BA249588D00C49F254018A42F2C6958#/metadata/f12c3826-4b4b-40e6-bf4f-77b9ed01dc14",
"boundaries", "icb22", "01.07.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/ICB_JUL_2022_EN_BUC_V3/FeatureServer/replicafilescache/ICB_JUL_2022_EN_BUC_V3_5138400207907180607.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::integrated-care-boards-july-2022-en-buc-4/explore",
"boundaries", "iz11", "01.01.11", "OGLv3", "https://maps.gov.scot/ATOM/shapefiles/SG_IntermediateZoneBdry_2011.zip", "https://spatialdata.gov.scot/geonetwork/srv/eng/catalog.search#/metadata/389787c0-697d-4824-9ca9-9ce8cb79d6f5",
"boundaries", "lhb20", "01.04.20", "OGLv3", "https://opendata.arcgis.com/datasets/ed5dccae76204a0ea411fcbbe1132659_0.geojson", "https://geoportal.statistics.gov.uk/datasets/local-health-boards-april-2020-wa-buc/explore?location=52.383842%2C-4.058123%2C8.70",
"boundaries", "lhb22", "14.04.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Local_Health_Boards_April_2022_WA_BFC_2022/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-health-boards-april-2022-wa-bfc-1/explore?location=52.389238%2C-4.227835%2C9.32",
"boundaries", "lsoa11", "01.12.11", "OGLv3", "https://opendata.arcgis.com/datasets/e9d10c36ebed4ff3865c4389c2c98827_0.geojson", "https://geoportal.statistics.gov.uk/datasets/lower-layer-super-output-areas-december-2011-boundaries-super-generalised-clipped-bsc-ew-v3/explore?location=52.837570%2C-2.489798%2C7.20",
"boundaries", "ltla19", "01.12.19", "OGLv3", "https://opendata.arcgis.com/datasets/3a4fa2ce68f642e399b4de07643eeed3_0.geojson", "https://geoportal.statistics.gov.uk/datasets/local-authority-districts-december-2019-boundaries-uk-buc/explore?location=55.340150%2C-3.316300%2C6.22",
"boundaries", "ltla20", "12.03.21", "OGLv3", "https://opendata.arcgis.com/datasets/69d8b52032024edf87561fb60fe07c85_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-districts-december-2020-uk-buc-1/explore?location=55.340122%2C-3.316413%2C5.95",
"boundaries", "ltla21", "01.12.21", "OGLv3", "https://opendata.arcgis.com/datasets/ac4ad96a586b4e4bab306dd59eb09401_0.geojson", "https://geoportal.statistics.gov.uk/datasets/local-authority-districts-december-2021-uk-buc/explore?location=57.654858%2C-11.079503%2C13.82",
"boundaries", "msoa11", "01.12.11", "OGLv3", "https://opendata.arcgis.com/datasets/80223f1d571c405fb2fdf719c7e6da13_0.geojson", "https://geoportal.statistics.gov.uk/datasets/middle-layer-super-output-areas-december-2011-boundaries-super-generalised-clipped-bsc-ew-v3/explore?location=52.846044%2C-2.465779%2C7.21",
"boundaries", "pfa20", "01.12.20", "OGLv3", "https://opendata.arcgis.com/datasets/2a1e3c23f1f24f15808275f52b8ae20d_0.geojson", "https://geoportal.statistics.gov.uk/datasets/police-force-areas-december-2020-ew-buc/explore?location=52.846527%2C-2.452657%2C7.21",
"boundaries", "region21", "15.03.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Regions_December_2021_EN_BFC/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::regions-december-2021-en-bfc/about",
"boundaries", "sdz21", "21.02.23", "OGLv3", "https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/geography-sdz2021-geojson.zip", "https://www.nisra.gov.uk/publications/geography-super-data-zone-boundaries-gis-format",
"boundaries", "soa11", "01.01.11", "OGLv3", "https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/SOA2011_Esri_Shapefile_0.zip", "https://www.nisra.gov.uk/publications/super-output-area-boundaries-gis-format",
"boundaries", "stp21", "01.04.21", "OGLv3", "https://opendata.arcgis.com/datasets/7ee99c1d8ef4424bab4b933a5dbe6aca_0.geojson", "https://geoportal.statistics.gov.uk/datasets/sustainability-and-transformation-partnerships-april-2021-en-buc/explore?location=52.846526%2C-2.452657%2C7.21",
"boundaries", "trusts_ni18", "21.03.18", "OGLv3", "https://www.opendatani.gov.uk/dataset/0b04b46c-49af-45d5-b277-91b10937a01b/resource/7fa52dde-90b8-446e-bb79-4871d1028cb4/download/dohtrustboundary.zip", "https://www.opendatani.gov.uk/dataset/department-of-health-trust-boundaries/resource/7fa52dde-90b8-446e-bb79-4871d1028cb4",
"boundaries", "utla19", "01.12.19", "OGLv3", "https://opendata.arcgis.com/datasets/b216b4c8a4e74f6fb692a1785255d777_0.geojson", "https://geoportal.statistics.gov.uk/datasets/counties-and-unitary-authorities-december-2019-boundaries-uk-buc/explore?location=54.155480%2C-3.250000%2C6.00",
"boundaries", "utla20", "28.04.21", "OGLv3", "https://opendata.arcgis.com/datasets/aff50e8d15364a7b82c62c14861eb240_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::counties-and-unitary-authorities-december-2020-uk-bgc/explore?location=54.650000%2C-3.250000%2C5.81",
"boundaries", "utla21", "15.09.21", "OGLv3", "https://opendata.arcgis.com/datasets/69109c4fbbc54f1f9d6e18000031a5fd_0.geojson", "https://geoportal.statistics.gov.uk/datasets/counties-and-unitary-authorities-may-2021-uk-buc/explore?location=55.340122%2C-3.316413%2C6.22",
"boundaries", "vcsep22", "14.09.22", "OGLv3", "https://raw.githubusercontent.com/VCS-Emergencies-Partnership/ad-hoc-analysis/main/analysis/vcsep_regions_boundaries/vcsep_regions_updated/vcsep_regions_updated.geojson", "https://github.com/VCS-Emergencies-Partnership/ad-hoc-analysis/tree/main/analysis/vcsep_regions_boundaries",
"boundaries", "wards21", "01.12.21", "OGLV3", "https://opendata.arcgis.com/datasets/bf9d32b1aa9941af84e6c2bf0c54b1bb_0.geojson", "https://geoportal.statistics.gov.uk/datasets/wards-december-2021-uk-bsc/explore",
"boundaries", "wards22", "25.11.22", "OGLV3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Wards_December_2022_Boundaries_UK_BSC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::wards-december-2022-boundaries-uk-bsc/about",
# Points
"points", "nhs_trusts22", "23.04.22", "OGLv3", "https://files.digital.nhs.uk/assets/ods/current/etr.zip", "https://digital.nhs.uk/services/organisation-data-service/file-downloads/other-nhs-organisations",
# Lookups
"lookup", "dz11_iz11_ltla20", "", "OGLv3", "https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2020/01/scottish-index-of-multiple-deprivation-2020-data-zone-look-up-file/documents/scottish-index-of-multiple-deprivation-data-zone-look-up/scottish-index-of-multiple-deprivation-data-zone-look-up/govscot%3Adocument/SIMD_2020_Datazone_lookup_tool.xlsx", "https://www.gov.scot/publications/scottish-index-of-multiple-deprivation-2020-data-zone-look-up/",
"lookup", "dz11_ltla19_hb19", "15.05.23", "OGLv3", "https://www.opendata.nhs.scot/en_GB/datastore/dump/d6e500c4-c1f2-4507-979a-e18855efd7a4?bom=True", "https://www.opendata.nhs.scot/en_GB/dataset/sub-health-and-social-care-partnership-areas/resource/d6e500c4-c1f2-4507-979a-e18855efd7a4",
"lookup", "dz21_sdz21_dea14_lgd14", "01.09.23", "OGLv3", "https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/geography-data-zone-and-super-data-zone-lookups.xlsx", "https://www.nisra.gov.uk/support/geography",
"lookup", "lsoa11_ccg21_stp21_ltla21", "01.04.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_CCG21_STP21_LAD21_EN_LU/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::lsoa-2011-to-clinical-commissioning-groups-to-sustainability-and-transformation-partnerships-april-2021-lookup-in-england/explore",
"lookup", "lsoa11_lsoa21_ltla22", "15.08.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_LSOA21_LAD22_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lsoa-2011-to-lsoa-2021-to-local-authority-district-2022-lookup-for-england-and-wales-version-2/about",
"lookup", "lsoa11_ltla19", "18.12.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_WD19_LAD19_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2019-lookup-in-england-and-wales/explore",
"lookup", "lsoa11_ltla20", "22.01.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_WD20_LAD20_EW_LU_v2/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2020-to-lad-2020-lookup-in-england-and-wales-v2/about",
"lookup", "lsoa11_ltla21", "25.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/81bcefcd048e43acb948ad069c5e06c0/data", "https://geoportal.statistics.gov.uk/documents/ons::lower-layer-super-output-area-2011-to-ward-2021-to-lad-2021-lookup-in-england-and-wales/about",
"lookup", "lsoa11_msoa11", "03.08.18", "OGLv3", "https://opendata.arcgis.com/datasets/fe6c55f0924b4734adf1cf7104a0173e_0.csv", "http://geoportal.statistics.gov.uk/datasets/fe6c55f0924b4734adf1cf7104a0173e_0",
"lookup", "lsoa11_sicbl22_icb22_ltla22", "01.07.22", "OGLv3", "https://opendata.arcgis.com/api/v3/datasets/423c8069710c4d488d5ff99475688101_0/downloads/data?format=csv&spatialRefId=4326&where=1%3D1", "https://geoportal.statistics.gov.uk/datasets/ons::lsoa-2011-to-sub-icb-locations-to-integrated-care-boards-july-2022-lookup-in-england/explore",
"lookup", "lsoa11_ward17", "", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_WD17_EW_LU_c65dfe9ca2fa4b0fa578b65a4d5c9856/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2017-lookup-in-england-and-wales-1/about",
"lookup", "ltla19_cauth19", "17.12.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LAD19_CAUTH19_EN_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-combined-authority-december-2019-lookup-in-england/about",
"lookup", "ltla20_cauth20", "27.11.2020", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LAD20_CAUTH20_EN_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-combined-authority-december-2020-lookup-in-england/about",
"lookup", "ltla21_cauth21", "17.02.22", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/93720e02514b408eb16cad5be13a2899/data", "https://geoportal.statistics.gov.uk/documents/local-authority-district-to-combined-authority-december-2021-lookup-in-england-v2/about",
"lookup", "ltla21_fra21", "30.03.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LAD21_FRA21_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-fire-and-rescue-authority-april-2021-lookup-in-england-and-wales/about",
"lookup", "ltla_ltla", "31.12.22", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/a8807f0914234a52b00edecdc34428fa/data", "https://geoportal.statistics.gov.uk/datasets/code-history-database-december-2021-for-the-united-kingdom/about",
"lookup", "ltla19_region19", "28.03.19", "OGLv3", "https://opendata.arcgis.com/datasets/3ba3daf9278f47daba0f561889c3521a_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-region-april-2019-lookup-in-england/about",
"lookup", "ltla20_region20", "30.11.20", "OGLv3", "https://opendata.arcgis.com/datasets/054349b09c094df2a97f8ddbd169c7a7_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-region-december-2020-lookup-in-england/about",
"lookup", "ltla21_region21", "30.03.21", "OGLv3", "https://opendata.arcgis.com/datasets/6a41affae7e345a7b2b86602408ea8a2_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-region-april-2021-lookup-in-england/about",
"lookup", "ltla19_utla19", "28.03.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LTLA19_UTLA19_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lower-tier-local-authority-to-upper-tier-local-authority-april-2019-lookup-in-england-and-wales/explore",
"lookup", "ltla20_utla20", "30.11.20", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LTLA20_UTLA20_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lower-tier-local-authority-to-upper-tier-local-authority-december-2020-lookup-in-england-and-wales/explore",
"lookup", "ltla21_lhb22", "30.12.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/UA22_LHB22_WA_LU/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::unitary-authority-to-local-health-board-december-2022-lookup-in-wales/explore",
"lookup", "ltla21_utla21", "30.03.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LTLA21_UTLA21_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lower-tier-local-authority-to-upper-tier-local-authority-april-2021-lookup-in-england-and-wales/explore",
"lookup", "ltla21_vcsep22", "14.09.22", "OGLv3", "https://raw.githubusercontent.com/VCS-Emergencies-Partnership/ad-hoc-analysis/main/analysis/vcsep_regions_boundaries/vcsep_regions_updated/vcsep_regions_updated_ltlas.csv", "https://github.com/VCS-Emergencies-Partnership/ad-hoc-analysis/blob/main/analysis/vcsep_regions_boundaries/vcsep_boundaries.R",
"lookup", "msoa11_ltla19", "18.12.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/MSOA11_WD19_LAD19_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::middle-layer-super-output-area-2011-to-ward-to-ltla-december-2019-lookup-in-england-and-wales/about",
"lookup", "msoa11_ltla20", "30.11.20", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/MSOA11_WD20_LAD20_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::middle-layer-super-output-area-2011-to-ward-to-ltla-december-2020-lookup-in-england-and-wales/about",
"lookup", "msoa11_ltla21", "25.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/b4c0247ef8564d419bdeb1eda13f2d0f/data", "https://geoportal.statistics.gov.uk/documents/middle-layer-super-output-area-2011-to-ward-to-ltla-december-2021-lookup-in-england-and-wales/about",
"lookup", "msoa11_msoa21_ltla22", "15.08.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/MSOA11_MSOA21_LAD22_EW_LU_V2/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::msoa-2011-to-msoa-2021-to-local-authority-district-2022-lookup-for-england-and-wales-version-2/about",
"lookup", "nhs_trust22_msoa11", "26.06.22", "?", "https://app.box.com/index.php?rm=box_download_shared_file&shared_name=qh8gzpzeo1firv1ezfxx2e6c4tgtrudl&file_id=f_976234504165", "https://app.box.com/s/qh8gzpzeo1firv1ezfxx2e6c4tgtrudl",
"lookup", "postcode_oa11_lsoa11_msoa11_ltla20", "23.11.20", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/9f629cd0c2fb42beb0d79a474fee4776/data", "https://geoportal.statistics.gov.uk/datasets/9f629cd0c2fb42beb0d79a474fee4776/about",
"lookup", "postcode_oa21_lsoa21_msoa21_ltla22", "29.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/bcfc75627db44bb4b0261f8578361954/data", "https://geoportal.statistics.gov.uk/datasets/postcode-to-output-area-hierarchy-to-ltla-to-utla-to-region-to-country-may-2021-lookup-in-england-and-wales-1/about",
"lookup", "sa11_soa11_lgd18", "23.08.22", "OGLv3", "https://opendata.arcgis.com/datasets/096a7ccbc8e244cc972189b2f07a321a_0.csv", "https://geoportal.statistics.gov.uk/datasets/small-areas-2011-to-soas-to-local-government-districts-december-2018-lookup-with-area-classifications-in-northern-ireland",
"lookup", "trust_trust_successor", "26.09.22", "OGLv3", "https://files.digital.nhs.uk/assets/ods/current/succ.zip", "https://digital.nhs.uk/services/organisation-data-service/file-downloads/miscellaneous",
"lookup", "trust_trust_successor_archived", "26.09.22", "OGLv3", "https://files.digital.nhs.uk/assets/ods/current/succarc.zip", "https://digital.nhs.uk/services/organisation-data-service/file-downloads/miscellaneous",
"lookup", "ward21_ltla21", "25.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/fe123ab719b2488ab41dd9c6aa84e79b/data", "https://geoportal.statistics.gov.uk/documents/ward-to-local-authority-district-december-2021-lookup-in-the-united-kingdom/about",
# Names and codes
"names_codes", "nhs_region21", "04.01.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/NHS_England_Regions_(April_2021)_in_England/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::nhs-england-region-april-2021-names-and-codes-in-england/about",
"names_codes", "nhs_scotland_health_boards19", "17.06.20", "OGLv3", "https://www.opendata.nhs.scot/dataset/9f942fdb-e59e-44f5-b534-d6e17229cc7b/resource/652ff726-e676-4a20-abda-435b98dd7bdc/download/hb14_hb19.csv", "https://www.opendata.nhs.scot/dataset/geography-codes-and-labels/resource/652ff726-e676-4a20-abda-435b98dd7bdc",
# Rural-Urban Classifications
"ruc", "ruc16_dz11", "01.01.16", "OGLv3", "https://www.gov.scot/binaries/content/documents/govscot/publications/advice-and-guidance/2018/03/scottish-government-urban-rural-classification-2016/documents/scottish-government-urban-rural-classification-2016-data-zone-lookup/scottish-government-urban-rural-classification-2016-data-zone-lookup/govscot%3Adocument/00544928.csv", "https://www.gov.scot/publications/scottish-government-urban-rural-classification-2016/pages/2/",
"ruc", "ruc11_lsoa11", "01.01.11", "OGLv3", "https://opendata.arcgis.com/datasets/276d973d30134c339eaecfc3c49770b3_0.geojson", "https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-lower-layer-super-output-areas-in-england-and-wales/explore",
"ruc", "ruc11_msoa11", "01.01.11", "OGLv3", "https://opendata.arcgis.com/datasets/0af77205a4644af3af2175d21a4ef4db_0.geojson", "https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-middle-layer-super-output-areas-in-england-and-wales/explore",
"ruc", "ruc11_wards11", "01.01.11", "OGLv3", "https://opendata.arcgis.com/datasets/21bb76b77a144ee081e8d846b888962f_0.geojson", "https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-wards-in-england-and-wales/explore"
)
usethis::use_data(query_urls, internal = TRUE, overwrite = TRUE)
# ---- Load libraries ----
library(tibble)
# ---- Build data ----
# ONS geoportal query urls can be found on the "API Explorer" tab.
query_urls <-
tribble(
# Column Names
~geog_type, ~id, ~publish_date, ~license, ~query, ~source,
# Boundaries
"boundaries", "ccg21", "01.04.21", "OGLv3", "https://opendata.arcgis.com/datasets/d6acd30ad71f4e14b4de808e58d9bc4c_0.geojson", "https://geoportal.statistics.gov.uk/datasets/clinical-commissioning-groups-april-2021-en-buc/explore?location=51.835875%2C-2.452657%2C6.00",
"boundaries", "countries20", "01.12.20", "OGLv3", "https://opendata.arcgis.com/datasets/bb7104d3a9c04937be57e408288282dc_0.geojson", "https://geoportal.statistics.gov.uk/datasets/countries-december-2020-uk-buc/explore?location=54.650000C-3.250000%2C6.04",
"boundaries", "dz11", "01.01.11", "OGLv3", "https://maps.gov.scot/ATOM/shapefiles/SG_DataZoneBdry_2011.zip", "https://spatialdata.gov.scot/geonetwork/srv/eng/catalog.search#/metadata/7d3e8709-98fa-4d71-867c-d5c8293823f2",
"boundaries", "hb19", "01.01.19", "OGLv3", "https://maps.gov.scot/ATOM/shapefiles/SG_NHS_HealthBoards_2019.zip", "https://spatialdata.gov.scot/geonetwork/srv/eng/catalog.search;jsessionid=2BA249588D00C49F254018A42F2C6958#/metadata/f12c3826-4b4b-40e6-bf4f-77b9ed01dc14",
"boundaries", "icb22", "01.07.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/ICB_JUL_2022_EN_BUC_V3/FeatureServer/replicafilescache/ICB_JUL_2022_EN_BUC_V3_5138400207907180607.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::integrated-care-boards-july-2022-en-buc-4/explore",
"boundaries", "iz11", "01.01.11", "OGLv3", "https://maps.gov.scot/ATOM/shapefiles/SG_IntermediateZoneBdry_2011.zip", "https://spatialdata.gov.scot/geonetwork/srv/eng/catalog.search#/metadata/389787c0-697d-4824-9ca9-9ce8cb79d6f5",
"boundaries", "lhb20", "01.04.20", "OGLv3", "https://opendata.arcgis.com/datasets/ed5dccae76204a0ea411fcbbe1132659_0.geojson", "https://geoportal.statistics.gov.uk/datasets/local-health-boards-april-2020-wa-buc/explore?location=52.383842%2C-4.058123%2C8.70",
"boundaries", "lhb22", "14.04.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Local_Health_Boards_April_2022_WA_BFC_2022/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-health-boards-april-2022-wa-bfc-1/explore?location=52.389238%2C-4.227835%2C9.32",
"boundaries", "lsoa11", "01.12.11", "OGLv3", "https://opendata.arcgis.com/datasets/e9d10c36ebed4ff3865c4389c2c98827_0.geojson", "https://geoportal.statistics.gov.uk/datasets/lower-layer-super-output-areas-december-2011-boundaries-super-generalised-clipped-bsc-ew-v3/explore?location=52.837570%2C-2.489798%2C7.20",
"boundaries", "ltla19", "01.12.19", "OGLv3", "https://opendata.arcgis.com/datasets/3a4fa2ce68f642e399b4de07643eeed3_0.geojson", "https://geoportal.statistics.gov.uk/datasets/local-authority-districts-december-2019-boundaries-uk-buc/explore?location=55.340150%2C-3.316300%2C6.22",
"boundaries", "ltla20", "12.03.21", "OGLv3", "https://opendata.arcgis.com/datasets/69d8b52032024edf87561fb60fe07c85_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-districts-december-2020-uk-buc-1/explore?location=55.340122%2C-3.316413%2C5.95",
"boundaries", "ltla21", "01.12.21", "OGLv3", "https://opendata.arcgis.com/datasets/ac4ad96a586b4e4bab306dd59eb09401_0.geojson", "https://geoportal.statistics.gov.uk/datasets/local-authority-districts-december-2021-uk-buc/explore?location=57.654858%2C-11.079503%2C13.82",
"boundaries", "msoa11", "01.12.11", "OGLv3", "https://opendata.arcgis.com/datasets/80223f1d571c405fb2fdf719c7e6da13_0.geojson", "https://geoportal.statistics.gov.uk/datasets/middle-layer-super-output-areas-december-2011-boundaries-super-generalised-clipped-bsc-ew-v3/explore?location=52.846044%2C-2.465779%2C7.21",
"boundaries", "pfa20", "01.12.20", "OGLv3", "https://opendata.arcgis.com/datasets/2a1e3c23f1f24f15808275f52b8ae20d_0.geojson", "https://geoportal.statistics.gov.uk/datasets/police-force-areas-december-2020-ew-buc/explore?location=52.846527%2C-2.452657%2C7.21",
"boundaries", "region21", "15.03.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Regions_December_2021_EN_BFC/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::regions-december-2021-en-bfc/about",
"boundaries", "sdz21", "21.02.23", "OGLv3", "https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/geography-sdz2021-esri-shapefile.zip", "https://www.nisra.gov.uk/publications/geography-super-data-zone-boundaries-gis-format",
"boundaries", "soa11", "01.01.11", "OGLv3", "https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/SOA2011_Esri_Shapefile_0.zip", "https://www.nisra.gov.uk/publications/super-output-area-boundaries-gis-format",
"boundaries", "stp21", "01.04.21", "OGLv3", "https://opendata.arcgis.com/datasets/7ee99c1d8ef4424bab4b933a5dbe6aca_0.geojson", "https://geoportal.statistics.gov.uk/datasets/sustainability-and-transformation-partnerships-april-2021-en-buc/explore?location=52.846526%2C-2.452657%2C7.21",
"boundaries", "trusts_ni18", "21.03.18", "OGLv3", "https://www.opendatani.gov.uk/dataset/0b04b46c-49af-45d5-b277-91b10937a01b/resource/7fa52dde-90b8-446e-bb79-4871d1028cb4/download/dohtrustboundary.zip", "https://www.opendatani.gov.uk/dataset/department-of-health-trust-boundaries/resource/7fa52dde-90b8-446e-bb79-4871d1028cb4",
"boundaries", "utla19", "01.12.19", "OGLv3", "https://opendata.arcgis.com/datasets/b216b4c8a4e74f6fb692a1785255d777_0.geojson", "https://geoportal.statistics.gov.uk/datasets/counties-and-unitary-authorities-december-2019-boundaries-uk-buc/explore?location=54.155480%2C-3.250000%2C6.00",
"boundaries", "utla20", "28.04.21", "OGLv3", "https://opendata.arcgis.com/datasets/aff50e8d15364a7b82c62c14861eb240_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::counties-and-unitary-authorities-december-2020-uk-bgc/explore?location=54.650000%2C-3.250000%2C5.81",
"boundaries", "utla21", "15.09.21", "OGLv3", "https://opendata.arcgis.com/datasets/69109c4fbbc54f1f9d6e18000031a5fd_0.geojson", "https://geoportal.statistics.gov.uk/datasets/counties-and-unitary-authorities-may-2021-uk-buc/explore?location=55.340122%2C-3.316413%2C6.22",
"boundaries", "vcsep22", "14.09.22", "OGLv3", "https://raw.githubusercontent.com/VCS-Emergencies-Partnership/ad-hoc-analysis/main/analysis/vcsep_regions_boundaries/vcsep_regions_updated/vcsep_regions_updated.geojson", "https://github.com/VCS-Emergencies-Partnership/ad-hoc-analysis/tree/main/analysis/vcsep_regions_boundaries",
"boundaries", "wards21", "01.12.21", "OGLV3", "https://opendata.arcgis.com/datasets/bf9d32b1aa9941af84e6c2bf0c54b1bb_0.geojson", "https://geoportal.statistics.gov.uk/datasets/wards-december-2021-uk-bsc/explore",
"boundaries", "wards22", "25.11.22", "OGLV3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/Wards_December_2022_Boundaries_UK_BSC/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::wards-december-2022-boundaries-uk-bsc/about",
# Points
"points", "nhs_trusts22", "23.04.22", "OGLv3", "https://files.digital.nhs.uk/assets/ods/current/etr.zip", "https://digital.nhs.uk/services/organisation-data-service/file-downloads/other-nhs-organisations",
# Lookups
"lookup", "dz11_iz11_ltla20", "", "OGLv3", "https://www.gov.scot/binaries/content/documents/govscot/publications/statistics/2020/01/scottish-index-of-multiple-deprivation-2020-data-zone-look-up-file/documents/scottish-index-of-multiple-deprivation-data-zone-look-up/scottish-index-of-multiple-deprivation-data-zone-look-up/govscot%3Adocument/SIMD_2020_Datazone_lookup_tool.xlsx", "https://www.gov.scot/publications/scottish-index-of-multiple-deprivation-2020-data-zone-look-up/",
"lookup", "dz11_ltla19_hb19", "15.05.23", "OGLv3", "https://www.opendata.nhs.scot/en_GB/datastore/dump/d6e500c4-c1f2-4507-979a-e18855efd7a4?bom=True", "https://www.opendata.nhs.scot/en_GB/dataset/sub-health-and-social-care-partnership-areas/resource/d6e500c4-c1f2-4507-979a-e18855efd7a4",
"lookup", "dz21_sdz21_dea14_lgd14", "01.09.23", "OGLv3", "https://www.nisra.gov.uk/sites/nisra.gov.uk/files/publications/geography-data-zone-and-super-data-zone-lookups.xlsx", "https://www.nisra.gov.uk/support/geography",
"lookup", "lsoa11_ccg21_stp21_ltla21", "01.04.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_CCG21_STP21_LAD21_EN_LU/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::lsoa-2011-to-clinical-commissioning-groups-to-sustainability-and-transformation-partnerships-april-2021-lookup-in-england/explore",
"lookup", "lsoa11_lsoa21_ltla22", "15.08.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_LSOA21_LAD22_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lsoa-2011-to-lsoa-2021-to-local-authority-district-2022-lookup-for-england-and-wales-version-2/about",
"lookup", "lsoa11_ltla19", "18.12.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_WD19_LAD19_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2019-lookup-in-england-and-wales/explore",
"lookup", "lsoa11_ltla20", "22.01.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_WD20_LAD20_EW_LU_v2/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2020-to-lad-2020-lookup-in-england-and-wales-v2/about",
"lookup", "lsoa11_ltla21", "25.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/81bcefcd048e43acb948ad069c5e06c0/data", "https://geoportal.statistics.gov.uk/documents/ons::lower-layer-super-output-area-2011-to-ward-2021-to-lad-2021-lookup-in-england-and-wales/about",
"lookup", "lsoa11_msoa11", "03.08.18", "OGLv3", "https://opendata.arcgis.com/datasets/fe6c55f0924b4734adf1cf7104a0173e_0.csv", "http://geoportal.statistics.gov.uk/datasets/fe6c55f0924b4734adf1cf7104a0173e_0",
"lookup", "lsoa11_sicbl22_icb22_ltla22", "01.07.22", "OGLv3", "https://opendata.arcgis.com/api/v3/datasets/423c8069710c4d488d5ff99475688101_0/downloads/data?format=csv&spatialRefId=4326&where=1%3D1", "https://geoportal.statistics.gov.uk/datasets/ons::lsoa-2011-to-sub-icb-locations-to-integrated-care-boards-july-2022-lookup-in-england/explore",
"lookup", "lsoa11_ward17", "", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LSOA11_WD17_EW_LU_c65dfe9ca2fa4b0fa578b65a4d5c9856/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::lower-layer-super-output-area-2011-to-ward-2017-lookup-in-england-and-wales-1/about",
"lookup", "ltla19_cauth19", "17.12.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LAD19_CAUTH19_EN_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-combined-authority-december-2019-lookup-in-england/about",
"lookup", "ltla20_cauth20", "27.11.2020", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LAD20_CAUTH20_EN_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-combined-authority-december-2020-lookup-in-england/about",
"lookup", "ltla21_cauth21", "17.02.22", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/93720e02514b408eb16cad5be13a2899/data", "https://geoportal.statistics.gov.uk/documents/local-authority-district-to-combined-authority-december-2021-lookup-in-england-v2/about",
"lookup", "ltla21_fra21", "30.03.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LAD21_FRA21_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-fire-and-rescue-authority-april-2021-lookup-in-england-and-wales/about",
"lookup", "ltla_ltla", "31.12.22", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/a8807f0914234a52b00edecdc34428fa/data", "https://geoportal.statistics.gov.uk/datasets/code-history-database-december-2021-for-the-united-kingdom/about",
"lookup", "ltla19_region19", "28.03.19", "OGLv3", "https://opendata.arcgis.com/datasets/3ba3daf9278f47daba0f561889c3521a_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-region-april-2019-lookup-in-england/about",
"lookup", "ltla20_region20", "30.11.20", "OGLv3", "https://opendata.arcgis.com/datasets/054349b09c094df2a97f8ddbd169c7a7_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-region-december-2020-lookup-in-england/about",
"lookup", "ltla21_region21", "30.03.21", "OGLv3", "https://opendata.arcgis.com/datasets/6a41affae7e345a7b2b86602408ea8a2_0.geojson", "https://geoportal.statistics.gov.uk/datasets/ons::local-authority-district-to-region-april-2021-lookup-in-england/about",
"lookup", "ltla19_utla19", "28.03.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LTLA19_UTLA19_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lower-tier-local-authority-to-upper-tier-local-authority-april-2019-lookup-in-england-and-wales/explore",
"lookup", "ltla20_utla20", "30.11.20", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LTLA20_UTLA20_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lower-tier-local-authority-to-upper-tier-local-authority-december-2020-lookup-in-england-and-wales/explore",
"lookup", "ltla21_lhb22", "30.12.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/UA22_LHB22_WA_LU/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::unitary-authority-to-local-health-board-december-2022-lookup-in-wales/explore",
"lookup", "ltla21_utla21", "30.03.21", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/LTLA21_UTLA21_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/lower-tier-local-authority-to-upper-tier-local-authority-april-2021-lookup-in-england-and-wales/explore",
"lookup", "ltla21_vcsep22", "14.09.22", "OGLv3", "https://raw.githubusercontent.com/VCS-Emergencies-Partnership/ad-hoc-analysis/main/analysis/vcsep_regions_boundaries/vcsep_regions_updated/vcsep_regions_updated_ltlas.csv", "https://github.com/VCS-Emergencies-Partnership/ad-hoc-analysis/blob/main/analysis/vcsep_regions_boundaries/vcsep_boundaries.R",
"lookup", "msoa11_ltla19", "18.12.19", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/MSOA11_WD19_LAD19_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::middle-layer-super-output-area-2011-to-ward-to-ltla-december-2019-lookup-in-england-and-wales/about",
"lookup", "msoa11_ltla20", "30.11.20", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/MSOA11_WD20_LAD20_EW_LU/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::middle-layer-super-output-area-2011-to-ward-to-ltla-december-2020-lookup-in-england-and-wales/about",
"lookup", "msoa11_ltla21", "25.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/b4c0247ef8564d419bdeb1eda13f2d0f/data", "https://geoportal.statistics.gov.uk/documents/middle-layer-super-output-area-2011-to-ward-to-ltla-december-2021-lookup-in-england-and-wales/about",
"lookup", "msoa11_msoa21_ltla22", "15.08.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/MSOA11_MSOA21_LAD22_EW_LU_V2/FeatureServer/0/query?where=1%3D1&outFields=*&outSR=4326&f=json", "https://geoportal.statistics.gov.uk/datasets/ons::msoa-2011-to-msoa-2021-to-local-authority-district-2022-lookup-for-england-and-wales-version-2/about",
"lookup", "nhs_trust22_msoa11", "26.06.22", "?", "https://app.box.com/index.php?rm=box_download_shared_file&shared_name=qh8gzpzeo1firv1ezfxx2e6c4tgtrudl&file_id=f_976234504165", "https://app.box.com/s/qh8gzpzeo1firv1ezfxx2e6c4tgtrudl",
"lookup", "postcode_oa11_lsoa11_msoa11_ltla20", "23.11.20", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/9f629cd0c2fb42beb0d79a474fee4776/data", "https://geoportal.statistics.gov.uk/datasets/9f629cd0c2fb42beb0d79a474fee4776/about",
"lookup", "postcode_oa21_lsoa21_msoa21_ltla22", "29.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/bcfc75627db44bb4b0261f8578361954/data", "https://geoportal.statistics.gov.uk/datasets/postcode-to-output-area-hierarchy-to-ltla-to-utla-to-region-to-country-may-2021-lookup-in-england-and-wales-1/about",
"lookup", "sa11_soa11_lgd18", "23.08.22", "OGLv3", "https://opendata.arcgis.com/datasets/096a7ccbc8e244cc972189b2f07a321a_0.csv", "https://geoportal.statistics.gov.uk/datasets/small-areas-2011-to-soas-to-local-government-districts-december-2018-lookup-with-area-classifications-in-northern-ireland",
"lookup", "trust_trust_successor", "26.09.22", "OGLv3", "https://files.digital.nhs.uk/assets/ods/current/succ.zip", "https://digital.nhs.uk/services/organisation-data-service/file-downloads/miscellaneous",
"lookup", "trust_trust_successor_archived", "26.09.22", "OGLv3", "https://files.digital.nhs.uk/assets/ods/current/succarc.zip", "https://digital.nhs.uk/services/organisation-data-service/file-downloads/miscellaneous",
"lookup", "ward21_ltla21", "25.11.21", "OGLv3", "https://www.arcgis.com/sharing/rest/content/items/fe123ab719b2488ab41dd9c6aa84e79b/data", "https://geoportal.statistics.gov.uk/documents/ward-to-local-authority-district-december-2021-lookup-in-the-united-kingdom/about",
# Names and codes
"names_codes", "nhs_region21", "04.01.22", "OGLv3", "https://services1.arcgis.com/ESMARspQHYMw9BZ9/arcgis/rest/services/NHS_England_Regions_(April_2021)_in_England/FeatureServer/0/query?outFields=*&where=1%3D1&f=geojson", "https://geoportal.statistics.gov.uk/datasets/ons::nhs-england-region-april-2021-names-and-codes-in-england/about",
"names_codes", "nhs_scotland_health_boards19", "17.06.20", "OGLv3", "https://www.opendata.nhs.scot/dataset/9f942fdb-e59e-44f5-b534-d6e17229cc7b/resource/652ff726-e676-4a20-abda-435b98dd7bdc/download/hb14_hb19.csv", "https://www.opendata.nhs.scot/dataset/geography-codes-and-labels/resource/652ff726-e676-4a20-abda-435b98dd7bdc",
# Rural-Urban Classifications
"ruc", "ruc16_dz11", "01.01.16", "OGLv3", "https://www.gov.scot/binaries/content/documents/govscot/publications/advice-and-guidance/2018/03/scottish-government-urban-rural-classification-2016/documents/scottish-government-urban-rural-classification-2016-data-zone-lookup/scottish-government-urban-rural-classification-2016-data-zone-lookup/govscot%3Adocument/00544928.csv", "https://www.gov.scot/publications/scottish-government-urban-rural-classification-2016/pages/2/",
"ruc", "ruc11_lsoa11", "01.01.11", "OGLv3", "https://opendata.arcgis.com/datasets/276d973d30134c339eaecfc3c49770b3_0.geojson", "https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-lower-layer-super-output-areas-in-england-and-wales/explore",
"ruc", "ruc11_msoa11", "01.01.11", "OGLv3", "https://opendata.arcgis.com/datasets/0af77205a4644af3af2175d21a4ef4db_0.geojson", "https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-middle-layer-super-output-areas-in-england-and-wales/explore",
"ruc", "ruc11_wards11", "01.01.11", "OGLv3", "https://opendata.arcgis.com/datasets/21bb76b77a144ee081e8d846b888962f_0.geojson", "https://geoportal.statistics.gov.uk/datasets/rural-urban-classification-2011-of-wards-in-england-and-wales/explore"
)
usethis::use_data(query_urls, internal = TRUE, overwrite = TRUE)
# ---- Load ----
library(tidyverse)
library(sf)
#library(lobstr)
library(devtools)
# Load package
load_all(".")
# Set query url
query_url <-
query_urls |>
filter(id == "sdz21") |>
pull(query)
# Unzip and then read
# GET and unzip shapefiles
GET(
query_url,
write_disk(
zip_folder <- tempfile(fileext = ".zip")
)
)
library(httr)
# Unzip and then read
# GET and unzip shapefiles
GET(
query_url,
write_disk(
zip_folder <- tempfile(fileext = ".zip")
)
)
unzip(zip_folder, exdir = tempdir())
shp <- file.path(tempdir(), "SOA2011.shp")
shp <- file.path(tempdir(), "SDZ2021.shp")
sdz <-
read_sf(shp) |>
st_transform(crs = 4326)
View(sdz)
sdz
# Select and rename vars
sdz <-
sdz |>
select(
sdz21_name = SDZ2021_nm,
sdz21_code = SDZ2021_cd,
geometry
)
# Make sure geometries are valid
sdz <- st_make_valid(sdz)
# Check geometry types are homogenous
if (sdz |>
st_geometry_type() |>
unique() |>
length() > 1) {
stop("Incorrect geometry types")
}
if (sdz |>
st_geometry_type() |>
unique() != "MULTIPOLYGON") {
stop("Incorrect geometry types")
}
# Check object is below 50Mb GitHub warning limit
if (obj_size(sdz) > 50000000) {
stop("File is too large")
}
library(lobstr)
# Check object is below 50Mb GitHub warning limit
if (obj_size(sdz) > 50000000) {
stop("File is too large")
}
# Check object is below 50Mb GitHub warning limit
if (obj_size(sdz) > 1) {
stop("File is too large")
}
# Rename
boundaries_sdz21 <- sdz
obj_size(sdz)
# Save output to data/ folder
usethis::use_data(boundaries_sdz21, overwrite = TRUE)
force(boundaries_ccg21)
View(boundaries_ccg21)
View(boundaries_sdz21)
obj_size(boundaries_ccg21)
# Simplify shape to reduce file size
sdz <- ms_simplify(sdz)
library(rmapshaper)
install.packages("mapshaper")
library(rmapshaper)
sdz
sdz
# Simplify shape to reduce file size
sdz <- ms_simplify(sdz)
# Check geometry types are homogenous
if (sdz |>
st_geometry_type() |>
unique() |>
length() > 1) {
stop("Incorrect geometry types")
}
if (sdz |>
st_geometry_type() |>
unique() != "MULTIPOLYGON") {
stop("Incorrect geometry types")
}
# Check object is below 50Mb GitHub warning limit
if (obj_size(sdz) > 50000000) {
stop("File is too large")
}
# Rename
boundaries_sdz21 <- sdz
# Save output to data/ folder
usethis::use_data(boundaries_sdz21, overwrite = TRUE)
load("C:/Users/JennaTan/Documents/geographr/R/sysdata.rda")
View(sysdata.rda)
# ---- Load ----
library(tidyverse)
library(sf)
library(lobstr)
library(rmapshaper)
library(devtools)
library(httr)
# Load package
load_all(".")
# Set query url
query_url <-
query_urls |>
filter(id == "sdz21") |>
pull(query)
# Unzip and then read
# GET and unzip shapefiles
GET(
query_url,
write_disk(
zip_folder <- tempfile(fileext = ".zip")
)
)
unzip(zip_folder, exdir = tempdir())
shp <- file.path(tempdir(), "SDZ2021.shp")
sdz <-
read_sf(shp) |>
st_transform(crs = 4326)
# Select and rename vars
sdz <-
sdz |>
select(
sdz21_name = SDZ2021_nm,
sdz21_code = SDZ2021_cd,
geometry
)
# Make sure geometries are valid
sdz <- st_make_valid(sdz)
# Simplify shape to reduce file size
sdz <- ms_simplify(sdz)
# Check geometry types are homogenous
if (sdz |>
st_geometry_type() |>
unique() |>
length() > 1) {
stop("Incorrect geometry types")
}
if (sdz |>
st_geometry_type() |>
unique() != "MULTIPOLYGON") {
stop("Incorrect geometry types")
}
# Check object is below 50Mb GitHub warning limit
if (obj_size(sdz) > 50000000) {
stop("File is too large")
}
# Rename
boundaries_sdz21 <- sdz
# Save output to data/ folder
usethis::use_data(boundaries_sdz21, overwrite = TRUE)
boundaries_sdz21
devtools::document()
devtools::check()
pkgload::load_package(".")
pkgload::load_all()
?boundaries_sdz21
